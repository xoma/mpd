В <a href='http://allframeworks.ru/blog/dancer/240.html'>прошлой заметке</a>  мы рассмотрели как установить Dancer, как создать и запустить первое приложение. 

Сегодня будет больше программирования...должно быть =)

Итак начнем!

Откроем файл ./lib/Engine.pm и еще раз посмотрим на его содержимое:

package Engine;

use Dancer ':syntax';

our $VERSION = '0.1';

get '/' => sub {
    template 'index';
};

true;

Для людей знакомых с Perl, в этом коде нет ничего необычного объявление пакета, подключение модуля и т.д. 

Не совсем обычно выглядит только конструкция:

get '/' => sub {
    template 'index';
};


Именно из таких конструкций и состоит любое Dancer-приложение, их называют роутами (в Mojolicious::Lite тоже были роуты, они и выглядели почти так же).
Каждый роут состоит из указания HTTP-метода (в нашем примере - get), пути, который подлежит обработке (в нашем случае это "/" - корень сайта) и блока кода (функции), который и содержит логику обработки указанного пути.
Проще всего разбираться на примерах, предположим, что нам нужно сделать страничку, отображающую иформацию о нашем приложении.
Допустим она будет открываться при запросе следующего url-адреса: http://mysite.ru/about/ - таким образом нам необходимо написать обработчик для пути "/about/", давайте это и сделаем. Добавим в файл Engine.pm следующие строки (перед вызовом функции "true" в конце файла):

get '/about/' => sub {
    return 'Our cool Dancer application about page!';
};

Изменения, сделанные нами можно видеть вот в <a href='https://github.com/xoma/mpd/commit/4eb9b78d5e193bc5f4134b9d508dcc8f1cc5211b'>этом коммите</a>.

После того как в приложение добавлен новый роут или изменен один из существующих, для того чтобы увидеть сделанные изменения - необходимо перезапустить сервер разработки. Для этого введем все ту же команду:

./bin/app.pl

Чтобы не делать этого каждый раз - необходимо запустить серер разработки в режиме "auto_reload". В этом режиме сервер автоматически перезапускается при изменении файла с роутами. Команда для запуска приложения примет следующий вид:

./bin/app.pl --restart=1 #TODO вот не работает оно и все, пока не знаю почему =(



